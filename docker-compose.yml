services:
  server:
    build:
      context: .
      dockerfile: server/Dockerfile
      args:
        AIKI_SERVER_PORT: ${AIKI_SERVER_PORT:-9850}
    container_name: aiki-server
    ports:
      - "${AIKI_SERVER_PORT:-9850}:${AIKI_SERVER_PORT:-9850}"
    environment:
      AIKI_SERVER_PORT: ${AIKI_SERVER_PORT:-9850}
      AIKI_SERVER_HOST: 0.0.0.0
      AIKI_SERVER_BASE_URL: ${AIKI_SERVER_BASE_URL:-http://localhost:9850}
      AIKI_SERVER_AUTH_SECRET: ${AIKI_SERVER_AUTH_SECRET:-yourSecretKey}
      CORS_ORIGINS: ${CORS_ORIGINS:-http://localhost:9851}
      DATABASE_PROVIDER: ${DATABASE_PROVIDER:-pg}
      DATABASE_URL: ${DATABASE_URL:-postgresql://user:password@host.docker.internal:5432/aiki}
      DATABASE_PATH: ${DATABASE_PATH:-:memory:}
      DATABASE_MAX_CONNECTIONS: ${DATABASE_MAX_CONNECTIONS:-10}
      DATABASE_SSL: ${DATABASE_SSL:-false}
      REDIS_HOST: ${REDIS_HOST:-host.docker.internal}
      REDIS_PORT: ${REDIS_PORT:-6379}
      REDIS_PASSWORD: ${REDIS_PASSWORD:-}
      LOG_LEVEL: ${LOG_LEVEL:-info}
      PRETTY_LOGS: ${PRETTY_LOGS:-true}
    restart: unless-stopped

  web:
    build:
      context: .
      dockerfile: web/Dockerfile
      args:
        VITE_AIKI_SERVER_URL: ${VITE_AIKI_SERVER_URL:-http://localhost:9850}
    container_name: aiki-web
    ports:
      - "${AIKI_WEB_PORT:-9851}:9851"
    depends_on:
      - server
    restart: unless-stopped
