services:
  server:
    build:
      context: .
      dockerfile: server/Dockerfile
      args:
        AIKI_SERVER_PORT: ${AIKI_SERVER_PORT:-9850}
    container_name: aiki-server
    ports:
      - "${AIKI_SERVER_PORT:-9850}:${AIKI_SERVER_PORT:-9850}"
    environment:
      AIKI_SERVER_PORT: ${AIKI_SERVER_PORT:-9850}
      AIKI_SERVER_HOST: 0.0.0.0
      LOG_LEVEL: ${LOG_LEVEL:-info}
      REDIS_HOST: ${REDIS_HOST:-host.docker.internal}
      REDIS_PORT: ${REDIS_PORT:-6379}
      PRETTY_LOGS: ${PRETTY_LOGS:-true}
    restart: unless-stopped

  web:
    build:
      context: .
      dockerfile: web/Dockerfile
      args:
        VITE_AIKI_SERVER_URL: ${VITE_AIKI_SERVER_URL:-http://localhost:9850}
    container_name: aiki-web
    ports:
      - "${AIKI_WEB_PORT:-9851}:9851"
    depends_on:
      - server
    restart: unless-stopped
